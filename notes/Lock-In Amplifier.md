A common task in experimental physics is **measuring extremely small electronic signals buried in noise** from a variety of sources.
An instrument commonly used to carry out this task is the Lock-In Amplifier, which uses the idea of lock-in detection.

## Structure of information
I will proceed in this order:
1. Appendix A - Modulation Spectroscopy: The Lock-In Amplifier, *The Art of Experimental Physics*, Preston and Dietz.
2. An Introduction to phase-sensitive amplifiers: An Inexpensive student instrument, Paul A. Temple, Am. J. Phys, 1975
3. The Lock-In Amplifier: A Student Experiment, R. Wofson, Am J. Phys.
4. Chapter 8 - Low Noise Techniques, The Art of Electronics, Horowitz (3rd Edition)
Any information that requires reference will have a tag with the numbering provided here.

## Low-Noise Techniques [^4]
An important part of dealing with small signal amplitudes is dealing with the noise that is introduced by the amplifier used with the signal.
### Cliffnotes
- Random noise is often characterised by its density, which is the RMS Noise amplitude in a 1Hz band of frequency. 
- **Voltage Noise Density** has units like $\frac{nV}{\sqrt{Hz}}$ . Denoted by $e_n$, often.
- Similarly, we have **noise current** (say, $i_n$) which flows through a device's resistance (Say $R_s$) and creates a noise voltage $e_n = i_n R_s$.
- If a noise source is uniform over frequency, it is **white noise**. In the case of white noise, the RMS noise voltage contained within a bandwidth $B$ is just given by: $v_n = e_n \sqrt{B}$.
- There are other sources of noise other than amps, of course. A major source is the Johnson-Nyquist Noise, and Shot Noise due to the flow of discrete charge carriers - both of these are white noises.
- **To figure out the total noise in a circuit with multiple noise sources, we have to take the sum of the squares of each noise density, multiply by the bandwidth, and then take the square root**.

### Noise
There are three main sources of noise, simply:
1. Unavoidable sources: Real fluctuations in the quantity being measured. This can only be overcome with signal averaging and bandwidth narrowing.
2. Other sources, like Radio frequency interference and ground loops. These are can be reduced using various techniques like filtering and careful wiring configuration.
3. Noise that arises from amplification process itself - can be reduced through techniques in low-noise amplifier design.
**Noise is characterised by its frequency spectrum**, the amplitude distribution, and its physical mechanism of generation.

The main sources of noise are now discussed.

#### Johnson-Nyquist Noise [^5]
Created across any resistive element across its terminals due to thermal fluctuations.
It has a flat frequency spectrum, which means that there is the same noise power in each hertz of frequency (upto reasonable limits). Thus, this is a white noise.
The open-circuit noise voltage generated by a resistance $R$ at a trmperature $T$ is given by:
$$
v_{noise}(rms) = \sqrt{4kTRB}
$$
Where $k$ is the Boltzmann constant, and $B$ is the bandwidth in Hz.
This is what would be measured if a perfectly noiseless band-pass filter of bandwidth $B$ is driven with the voltage generated by a resistor at a temperature $T$.
Example: A $10k \Omega$ resistor at room temperature has an open circuit RMS voltage of $1.3 \mu V$ measured on a band-width of $10 kHz$.
If the ends of the resistor $R$ is shorted, we will get a short-circuit current given by:
$$
i_{noise}(rms) = \frac{v_n}{R} = \sqrt{\frac{4kTB}{R}}
$$
It is often convenient to express the noise as a voltage/current density $e_n$ (rms voltage per square root bandwidth). Johnson noise is flat, and thus has the constant noise voltage density:
$$
e_n = \sqrt{4kTR} \frac{V}{\sqrt{Hz}}
$$
Likewise, the noise current density is:
$$
i_n = \sqrt{\frac{4kT}{R}} \frac{A}{\sqrt{Hz}}
$$
![[Pasted image 20251126020618.png]]
(Source: [^4])

The amplitude of the JN Noise voltage at any instance is in general unpredictable - it obeys a **Gaussian** amplitude distribution.

![[Pasted image 20251126020836.png]]
(Source: [^4])

JN Noise is significant as it sets a lower limit on the noise voltage in any detector, signal source, or amplifier that has resistance. It is to be noted that JN Noise is a special case of the fluctuation-dissipation phenomenon, and analogues of it show up in any system with a analogous loss of energy.

JN Noise should not be confused with the additonal noise voltage that is created by the effect of resistance fluctuations when an externally applied current flows through a resistor - this excess noise is 1/f, and is very dependent on the construction of the resistor itself.

#### Shot Noise
An electric current consists of flowing discrete electric charges, and is thus not a smooth/continuous flow. This finiteness of the quanta of charge results in fluctuations of the current. If the charges can be assumed to act independently of each other, the fluctuating current's noise density is given by:
$$
i_n = \sqrt{2qI_{dc}} \frac{A}{\sqrt{Hz}}
$$
Where $q$ is the carrier charge, and $I_{dc}$ is the DC current being driven.
Like JN noise, this noise is white and Gaussian. So, over a bandwidth $B$, we get:
$$
i_{noise}(rms) = i_n \sqrt{B} \text{ A(rms)}
$$
Example: A steady DC current of $1 A$ actually has an RMS fluctuations of $57 nA$ measured in a $10 kHz$ bandwidth.

The assumption made here of the charges acting independently is true foe cases like charges crossing a barrier - for example the current in a junction diode (where charge is carried via diffusion). But it is not true for the case of metallic conductors, where there are long-range correlations between the charge carriers. This correlation causes a major reduction in the shot-noise predicted by the formula given here.

### 1/f noise (flicker noise)
Real resistors experience extra noise on top of Johnson-Nyquist and shot noise due to fluctuations in resistance. This noise has an approximately $\frac{1}{f}$ power spectrum and is often called "pink noise". Plotted against voltage or current (rather than power), the amplitude falls as $\frac{1}{\sqrt{f}}$ as shown:

![[Pasted image 20251126022550.png]]
(Source: [^4])

Note that "red noise" refers to noise that has a $\frac{1}{f^2}$ spectrum.
$f_c$ is used to refer to the corner frequency at which the $\frac{1}{f}$ noise power is the same as the underlying white noise component. The combined noise voltage density can easily be obtained using:
$$
e_n(f) = e_{n(white)}\sqrt{1 + \frac{f_c}{f}}
$$
From which the RMS integrated noise voltage in a bandwidth can be calculated.

There are other sources of $\frac{1}{f}$ noise - examples are base-current noise in transistors, cathode current noise in vacuum tubes. It also shows up in unexpected places, example the speed of ocean currents, the flow of sand in an hourglass, and the flow of traffic on expressways. [^6]

#### Burst Noise
Not all noise sources are characterised by a Gaussian amplitude distribution (or even smooth distributions, for that matter). The most common among the exceptions is burst noise (also called bistable noise, or random telegraph noise). It is occasionally seen in semiconductor devices. It consists of random jumps between two voltage levels taking place on the time scales of tens of milliseconds.

![[Pasted image 20251126023956.png]]
(Source: [^4])

In frequency domain, the effect of burst noise is a raised low frequency portion without any obvious spectral peaks. This is believed to be caused by intermittent trapping of charge carriers at the defects and interfaces of the semiconductor devices. It is virtually absent in modern semiconductor devices.

#### Band-limited noise
All circuits operate in an effective limited frequency band. So, the RMS noise voltage contained in a signal is often more useful that noise-density quantities. 
Let us imagine a white noise source that is passed through a perfectly sharp bandpass filter. Then, the band-limited RMS amplitude is simply given by:
$$
v_{n(rms)} = e_n \sqrt{B}
$$
But such filters are not practical - we have sloping attenuation at the ends. The equivalent bandwidth for something like a RC lowpass filter is given by:
$$
B = \frac{\pi}{2} f_{3dB} = 1.57 f_{3dB} = \frac{1}{4RC} \text{ Hz}
$$
Where $f_{3bD} = \frac{1}{2 \pi RC}$. Higher order filters (2-pole Butterworth lowpass) can be used to reduce the bandwidth multiplier (1.57 here) even further. For slowly varying (or DC) signals, a simple averaging can reduce it even further to an equivalent bandwidth of $B = \frac{1}{2}T$, where $T$ is the duration of the uniform averaging of the input signal.

#### Other noise spectra
In this acse, we can not simply multiply the noise density by the square root of the bandwidth. Instead, we have to integrate the varying noise density over the bandpass. For an ideal bandpass filter, this would be given by:
$$
v_n^2 = \int_{f_1}^{f_2} e_n^2 df
$$
For real filters, you have to further multiply the noise density with the filter's spectral response over the bandwidth and then perform the integral.

#### Interference
Interfering signals or stray pickup constitutes a form of noise.
Example: The 50Hz powerline pickup has a sharp peak in its spectrum, and hs a relatively constant amplitude. Other (impulsive) sources like car ignition noise, lightning, etc. are broad in spectrum and spiky in the amplitude distribution. Cellphones are particularly relevant problem, as they generate such signals even when idle.
Many of these sources can be controlled by shielding and filtering, whereas sometimes we may have to use constant-temperature rooms and Faraday cages to electrically shield the circuit.

### Signal-to-noise ratio and noise figure
These are noise ratios that are measured at the same place in a particular circuit, made to describe source noise and amplifier noise in terms of microvolts at the input that would generate the observed output noise. This is realistic, as most of the amplifier noise is added at the input stage. 

### Noise power density
When you add two signals that are **uncorrelated** (two noise signals, or noise plus a real signal), you add their noise power, i.e. their squared amplitudes:
$$
v = \sqrt{v_s^2 + v_n^2}
$$
Where $v$ is the rms signal obtained by adding together a signal of RMS amplitude $v_s$ and a noise signal of RMS amplitude $v_n$. The RMS amplitudes do not simply add.

### Signal-to-noise ratio
The signal-to-noise ratio (SNR) is defined simply as:
$$
SNR = 10 \log_{10} \left( \frac{v_s^2}{v_n^2} \right) = 20 \log_{10} \left( \frac{v_s}{v_n} \right) \text{ dB}
$$
Where the voltages are RMS values, and we have specified some bandwidth and center frequency.

### Noise figure
Any real signal source produces Johnson-Nyquist noise due to the real part of its complex source impedance. The noise figure (NF) of an amplifier is simply the ratio in decibels of the output of the real amplifier to the output of a perfect (noiseless) amplifier of the same gain, with a resistor if value $R_s$ connected across the amplifier's input terminals in each case. Thus, the Johnson noise for such a transistor is the input signal, and NF is given by:
$$
NF = 10 \log_{10} \left( \frac{4kTR_s + v_n^2}{4kTR_s}\right) \text{ dB}
$$
Where $v_n^2$ is the Mean squared noise voltage per hertz contributed by the amplifier, with a noiseless resistor $R_s$ connected across its input - this restriction is important as the noise voltage contributed by the amplifier depends very much on the source impedance.

## Lock-In Detection
There are two steps to this method of detection:
1. Some parameter of the source signal is modulated. Ex: An LED being driven with a square wave at a fixed frequency.
2. The detected (noisy) signal is demodulated. Ex: Multiplied with a fixed-amplitude reference signal at the same modulating frequency.
The modulation moves the source signal spectrum yo to the modulating frequency - normally way above the noisy 1/f low-frequency backgrounds, and from other ambient noise sources.
The demodulation step creates a DC output proportional to the signal, which can be lowpass filtered to narrow the detected bandwidth.

[^1]Note that in most experiments we have a signal that is a function of some single varied parameter (while we hold any other parameters constant). Let us say we have a signal $e_s(K)$
where $K$ is the parameter being varied. To make the signal periodic for lock-in detection, we simply sweep over the required values of $K$ in a periodic manner. Let us have $\Delta K = k \cos(\omega t)$, where $k$ is the amplitude (assumed to be small relative to the range of $K$), and $\omega$ is the frequency.

![[Pasted image 20251126215738.png]]
(Source: [^1])

Some examples of signal and parameter it depends on are:
1. Frank-Hertz: Signal - Transmission current, Parameter - Accelerating voltage
2. NMR: Signal - RF Power absorbed, Parameter - DC Magnetic Field
3. ESR: Signal - Microwave power absorbed, Parameter - DC Magnetic Field
As can be seen from the diagram above, such an AC variation in the parameter allows us to measure $\frac{d e_s}{dK}$ and other higher derivatives. Further, expanding the signal in a Taylor Series:
$$
e_s(K + \Delta K) = e_s(K) + \frac{d e_s}{dK} \Delta K + \frac{1}{2} \frac{d^2 e_s}{dK^2} (\Delta K)^2 + \dots
$$
Where we have $\Delta K = k \cos(\omega t)$. Putting this in, and using the half angle identity:
$$
e_s(K + \Delta K) = e_s(K) + \frac{d e_s}{dK} k \cos(\omega t) + \frac{1}{2} \frac{d^2 e_s}{dK^2} \frac{1}{2} (1+\cos(2\omega t)) + \dots
$$
Thus, the modulation results in a signal that has a DC component $e_s (K)$ and the higher order components are periodic with angular frequencies $\omega_n = n \omega, n \in \mathbb{N}$. Note that with lock-in detection, we may measure the signal component with the frequency $\omega$ to get a signal proportional to the first derivative of the signal as shown. The same process can be carried out for any higher derivative.

![[Pasted image 20251126222608.png]]
(Source: [^1] Example of the detection of derivatives of the signal)

### Phase detectors
For lock-in detection, we need linear phase detectors - because we are nearly always dealing with analog voltage levels.
![[Pasted image 20251126190355.png]]
(Source: [^4])

This is the simplest such linear phase detector. An analog signal passes through a linear amplifier whose gain is reversed by a square-wave "reference" signal controlling a FET switch. The output signal passes through a lowpass RC filter.

Now, we analyse the output of this phase detector.
Assume that we apply the signal:
$$
E_s \cos(\omega t + \phi)
$$
to the phase detector, whose reference signal is a square wave with transitions at the zeros of $\sin(\omega t)$ - i.e. at $t = \frac{n \pi}{\omega}, n \in \mathbb{N}$ . Let us further assume that we average the output $V_{out}$, by passing it through a lowpass filter whose time constant is much longer than one period:
$$
\tau = RC >> T = \frac{2 \pi}{\omega}
$$
Then, the lowpass filter output is:
$$
\langle E_s \cos(\omega t + \phi) \rangle|^{\pi/\omega}_{0} - \langle E_s \cos(\omega t + \phi) \rangle|_{\pi/\omega}^{2 \pi / \omega}
$$
Where $\langle \rangle$ represents averages and the minus sign comes from the gain reversal over alternate half-cycles of $V_{ref}$. 
[^2]In general, the various noise signal components bear no temporal relationship tp the sampling rate, and will generally average to zero.
We know then,
$$
\langle V_{out} \rangle = - \frac{2 E_s}{\pi} \sin(\phi)
$$
This shows that the averaged output, for an input signal of the same frequency as the reference signal is proportional to the amplitude of $V_s$ and sinusoidal in the relative phase.

![[Pasted image 20251126222157.png]]
(Source: [^1], Alternate labelled circuit of Phase Detector)
![[Pasted image 20251126222307.png]]
(Source: [^1] Example output of Phase detector)

When we have a definite phase relationship between the signal and the reference signal, we say that the input signal is **phase locked** to the reference signal. What happens to the noise at the same frequency as the input signal? Note that the phase of the noise (relative to the reference signal) is **random**, and the output of the RC filter averages it to zero.

But in reality, such an exact match of frequencies is not often achieved. We often get frequencies that are close to each other. What is the output voltage in that case? In this case, the relative phase $\phi$ now varies slowly. This is shown by:

$$
cos(\omega + \Delta \omega)t = \cos(\omega t + \phi)
$$
Where $\phi = r \Delta \omega$.
Which gives us the output signal:
$$
V_{out} = \frac{2 E_s}{\pi} \sin(r \Delta \omega)
$$
Which is a slow sinusoid, and will thus pass through the lowpass filter relatively un-attenuated if $\Delta \omega < \frac{1}{\tau} = \frac{1}{RC}$ and will be heavily attenuated in the opposite regime.

[^2]Simply put, we are telling the lock-in detector when the input has signal AND noise, and when it has only noise (due to modulation). This information is what allows us to reject the noise. The useful signal is not present at the input at all when the negative gain input is being integrated by the filter, and the signal is present when the positive gain input is being integrated by the filter.

### The lock-in method
Now, with the phase detectors, we can move on to the lock-in method.
First, we have to make a weak signal periodic. The weak signal, contaminated by noise, is amplified and phase detected relative to the modulating signal.

![[Pasted image 20251126192323.png]]
(Source: [^4])

The phase shifter is adjusted to give the maximum output signal, and the low-pass filter is set for a time-constant long enough to give a good signal-to-noise ratio. Since the lowpass filter rolloff sets the bandwidth, the bandwidth of the rolloff determines the sensitivity to noise near the desired signal.
This bandwidth will also determine how fast we can adjust the modulation, as we can not sweep through features of the signal faster than the filter can respond.

So, lock-in detection essentially amounts to **bandwidth narrowing**, with the bandwidth set by the post-detection lowpass filter. 

### Problem of "synchronous" noise
[^2] Let us assume an experiment where we are attempting to measure the Tyndall scattering of light by some amount of material.
![[Pasted image 20251126224416.png]]
(Source: [^2])

Now, if we set the chopper that illuminates the sample to a frequency that is not shared by any ambient interference source, we can essentially cut them out. But the noise caused by dirt on the sample window scattering the light occurs only when the signal is also on - this kind of noise is called "synchronous", and must be avoided by careful experimental design.

Note: The fundamental trade-off here when we increase the time constant of the filter is the loss of fidelity of the signal - we lose the ability to measure quick changes in the signal. We gain with lower noise as the noise gets averaged out.

## Square wave modulation vs. Sine Wave modulation [^2]
If we choose a reference that is a square wave, we will obtain a non-zero signal at every odd multiple of the fundamental frequency of the square wave. This is due to the Fourier expansion of the periodic square wave - and it is not always undesirable as these higher harmonics can have useful information regarding the signal.

If we do not wish for any harmonic signal being detected, we can use a sine wave modulation for the reference. Then, the response of the detector would be zero to all signals with frequencies not equal to the reference. **Sometimes for small reference frequencies, the bandpass filter may not be able to attenuate the first (few) harmonics even in the case of the sine modulation. In this case, other filters focused on these harmonics must be added to remove the noise.**

## Notes to self
- Write about the "Rusty Bolt" effect that causes the creation of harmonics in a signal of a fixed frequency. Has to do with nonlinear response in the media carrying the signals (Telegrapher's equation). Relevant to us avoiding multiples of 50Hz and so.
# Footnotes
[^1]: Appendix A - Modulation Spectroscopy: The Lock-In Amplifier, *The Art of Experimental Physics*, Preston and Dietz.

[^2]: An Introduction to phase-sensitive amplifiers: An Inexpensive student instrument, Paul A. Temple, Am. J. Phys, 1975

[^3]: The Lock-In Amplifier: A Student Experiment, R. Wofson, Am J. Phys.

[^4]: Chapter 8 - Low Noise Techniques, The Art of Electronics, Horowitz (3rd Edition)

[^5]: "Thermal agitation of electricity in conductors", J. B. Johnson, Letter to Nature, 119, 50 (1927)

[^6]: W. H. Press, "Flicker noise in astronomy and elsewhere", Comm. on Astrophys, 7, 103-119 (1978)
